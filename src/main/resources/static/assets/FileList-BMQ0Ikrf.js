import{_ as q,r as u,c as _,o as y,F as j,e as te,n as we,f as b,g as F,t as O,h as E,i as Fe,j as Ve,k as ee,l as N,m as me,p as B,u as be,b as Re,q as _e,w as ze,d as We,s as Be,v as He,a as he,x as Ae,y as Y,z as Ue,A as Ne,B as Oe}from"./index-BXMdD4VW.js";import{a as fe,p as qe}from"./path_utils-D1isD2PO.js";const pe=["mp4","wmv","flv","rm","mp4","3gp","avi","mpg","rmvb","mov","m4v","m3u8","mkv","asf","mts"],ge=["jpg","png","jpeg","tiff","gif","eps","svg","bmp","webp"],ye=["zip","7z","rar","tar"],L={VIDEO_SUFFIX:pe,IMAGE_SUFFIX:ge,PACKAGE_SUFFIX:ye,isVideo(v){return v==null||v===""?!1:pe.indexOf(v.toLowerCase())!==-1},isImage(v){return v==null||v===""?!1:ge.indexOf(v.toLowerCase())!==-1},isPackage(v){return v==null||v===""?!1:ye.indexOf(v.toLowerCase())!==-1}},je={class:"file-viewer"},Ge=["id","onClick"],Ke={class:"icon-container"},Je=["src"],Qe=["src"],Ze={class:"file-name"},et={__name:"FileViewer",props:{multiple:{type:Boolean,default:!1},files:{type:Array,required:!0},fileType:{type:String,required:!0},fileName:{type:String,required:!0},mimeType:{type:String,required:!0},empty:String,getIcon:Function,idProp:String},emits:["choose"],setup(v,{emit:w}){const p=w,m=v;function T(n){if(!m.multiple){p("choose",[n]);return}n.selected=!n.selected;let c=[];for(let d of m.files)d.selected&&c.push(d);p("choose",c)}const o=u({});function r(n){var c;return n[m.fileType]==="folder"?m.empty&&n[m.empty]?"/icons/folder_empty.png":"/icons/folder.png":(c=n[m.mimeType])!=null&&c.startsWith("video")||L.isVideo(n[m.fileType])?"/icons/video.png":L.isImage(n[m.fileType])?"/icons/image.png":L.isPackage(n[m.fileType])?"/icons/package.png":"/icons/unknown.png"}function x(n){const c=n.id||n[m.fileName];if(o.value[c]===void 0&&(o.value[c]={defaultIcon:r(n),customIcon:null,loading:!1,loaded:!1},typeof m.getIcon=="function")){const d=m.getIcon(n);if(typeof d=="string"&&d.trim()!==""){o.value[c].loading=!0;const S=new Image;S.onload=()=>{o.value[c]={...o.value[c],customIcon:d,loading:!1,loaded:!0}},S.onerror=()=>{o.value[c].loading=!1},S.src=d}}return o.value[c]}return(n,c)=>(y(),_("ul",je,[(y(!0),_(j,null,te(v.files,d=>(y(),_("li",{id:d[m.idProp],onClick:S=>T(d),class:we(["viewer-item",{selected:d.selected}])},[b("div",Ke,[b("img",{class:"main-icon",src:x(d).customIcon||x(d).defaultIcon},null,8,Je),x(d).customIcon?(y(),_("img",{key:0,class:"small-default-icon",src:x(d).defaultIcon},null,8,Qe)):F("",!0)]),b("p",Ze,O(d[v.fileName]),1)],10,Ge))),256))]))}},tt=q(et,[["__scopeId","data-v-bbc9a87d"]]),at=["src"],nt={key:0,class:"loading-indicator"},it={key:1,class:"error-indicator"},lt={class:"control-buttons"},st={class:"thumbnail-scroll-container"},ot=["onClick"],rt=["src","data-index"],ct=3e3,ut=50,vt=.5,dt={__name:"ImagePreview",props:{images:{type:Array,required:!0,default:()=>[]},initialIndex:{type:Number,default:0},initialUrl:{type:String,default:""},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","close"],setup(v,{emit:w}){const p=v,m=w,T=u(p.modelValue),o=u(p.initialIndex),r=u(1),x=u(0),n=u({x:0,y:0}),c=u(!1),d=u(!1),S=u(null),g=u(null),C=u(null),R=u(null),X=u({width:0,height:0}),i=u({width:0,height:0}),h=u({width:0,height:0}),f=u(!0),P=u(null),l=u({mode:null,startX:0,startY:0,startDistance:0,startScale:1,startPosition:{x:0,y:0},lastTouchTime:0,isSwiping:!1,centerPoint:{x:0,y:0}}),G=u(0),K=u(0),J=u(0),xe=E(()=>({width:`${X.value.width}px`,height:`${X.value.height-160}px`})),V=E(()=>{if(!g.value||!C.value)return 1;const e=C.value.clientWidth,t=C.value.clientHeight-160,a=i.value.width,s=i.value.height,I=e/a,k=t/s;return Math.max(Math.min(I,k),.5)}),z=E(()=>p.images.map(e=>typeof e=="string"?{src:e,thumbnailSrc:e}:{...e,thumbnailSrc:e.thumbnailSrc||e.src})),ae=E(()=>z.value[o.value]||{}),Ie=E(()=>({transform:`scale(${r.value}) rotate(${x.value}deg) translate(${n.value.x}px, ${n.value.y}px)`,transition:l.value.mode==="drag"?"none":"transform 0.2s ease-out"})),H=()=>{clearTimeout(P.value),P.value=setTimeout(()=>{f.value=!1},ct)},ne=()=>{f.value=!0,H()},ie=()=>{f.value=!f.value,f.value&&H()},Q=()=>{S.value&&(X.value={width:S.value.clientWidth,height:S.value.clientHeight})},M=()=>{if(!g.value||!C.value)return;const e=C.value,t=r.value,a=i.value.width*t,s=i.value.height*t,I=Math.max(0,(a-e.clientWidth)/2),k=Math.max(0,(s-e.clientHeight)/2);n.value={x:Math.max(-I,Math.min(I,n.value.x)),y:Math.max(-k,Math.min(k,n.value.y))},r.value=Math.max(V.value,Math.min(5,r.value))},$=()=>{if(r.value=Math.max(V.value,1),x.value=0,n.value={x:0,y:0},ce()&&g.value){const e=g.value,t=e.naturalHeight/e.naturalWidth,a=X.value.width,s=X.value.height-160;a*t>s?(e.style.height=`${s}px`,e.style.width=`${s/t}px`):(e.style.width=`${a}px`,e.style.height=`${a*t}px`)}B(()=>M())},ke=()=>{if(c.value=!1,d.value=!1,g.value&&(i.value={width:g.value.naturalWidth,height:g.value.naturalHeight},r.value=Math.max(V.value,1),ce())){const e=g.value,t=e.naturalHeight/e.naturalWidth,a=X.value.width,s=X.value.height-160;a*t>s?(e.style.height=`${s}px`,e.style.width=`${s/t}px`):(e.style.width=`${a}px`,e.style.height=`${a*t}px`)}$()},Te=()=>{c.value=!1,d.value=!0},Se=e=>{e.button===0&&(e.preventDefault(),l.value={mode:"drag",startX:e.clientX,startY:e.clientY,startPosition:{...n.value},startScale:r.value,isSwiping:!0},document.addEventListener("mousemove",le),document.addEventListener("mouseup",A),document.addEventListener("mouseleave",A))},le=e=>{if(l.value.mode!=="drag")return;const t=e.clientX-l.value.startX,a=e.clientY-l.value.startY;n.value={x:l.value.startPosition.x+t,y:l.value.startPosition.y+a},M()},A=()=>{l.value.mode==="drag"&&(l.value.mode=null,document.removeEventListener("mousemove",le),document.removeEventListener("mouseup",A),document.removeEventListener("mouseleave",A),M())},Me=e=>{if(e.touches.length===1)l.value={mode:"switch",startX:e.touches[0].clientX,startY:e.touches[0].clientY,startPosition:{...n.value},startScale:r.value,lastTouchTime:Date.now(),isSwiping:!1},G.value=0,K.value=Date.now(),J.value=e.touches[0].clientX;else if(e.touches.length===2){const t=e.touches[0],a=e.touches[1];l.value={mode:"zoom",startDistance:oe(t.clientX,t.clientY,a.clientX,a.clientY),startScale:r.value,startPosition:{...n.value},centerPoint:re(t.clientX,t.clientY,a.clientX,a.clientY)}}},Pe=e=>{if(l.value.mode==="switch"&&e.touches.length===1){const t=e.touches[0],a=t.clientX-l.value.startX,s=t.clientY-l.value.startY,I=Date.now(),k=I-K.value,W=t.clientX-J.value;k>0&&(G.value=W/k),K.value=I,J.value=t.clientX,!l.value.isSwiping&&(Math.abs(a)>5||Math.abs(s)>5)&&(l.value.isSwiping=!0),l.value.isSwiping&&(r.value===1?n.value={x:l.value.startPosition.x+a,y:l.value.startPosition.y+s}:(n.value={x:l.value.startPosition.x+a,y:l.value.startPosition.y+s},M())),e.preventDefault()}else if(l.value.mode==="zoom"&&e.touches.length===2){const t=e.touches[0],a=e.touches[1],s=oe(t.clientX,t.clientY,a.clientX,a.clientY),I=Math.max(V.value,Math.min(5,l.value.startScale*(s/l.value.startDistance))),k=re(t.clientX,t.clientY,a.clientX,a.clientY),W=k.x-l.value.centerPoint.x,Z=k.y-l.value.centerPoint.y;n.value={x:l.value.startPosition.x+W,y:l.value.startPosition.y+Z},r.value=I,M(),e.preventDefault()}},Xe=e=>{if(l.value.mode==="switch"&&l.value.isSwiping){if(r.value===1){const t=e.changedTouches[0].clientX-l.value.startX;Date.now()-l.value.lastTouchTime;const a=Math.min(vt,Math.max(-.5,G.value)),s=t+a*100;(Math.abs(s)>ut||Math.abs(a)>.2)&&(s>0?D(o.value-1):D(o.value+1))}r.value===1&&$()}else l.value.mode==="zoom"&&M();l.value.mode=null},Ce=e=>{if(!g.value)return;e.preventDefault();const t=e.deltaY>0?-.1:.1,a=Math.max(V.value,Math.min(5,r.value+t)),s=g.value.getBoundingClientRect(),I=e.clientX-s.left,k=e.clientY-s.top,W=s.width/2,Z=s.height/2,De=I-W,Ee=k-Z;n.value={x:n.value.x-De*(a-r.value)/r.value,y:n.value.y-Ee*(a-r.value)/r.value},r.value=a,M()},$e=e=>{if(r.value===1){const t=g.value.getBoundingClientRect(),a=t.width/2,s=t.height/2,I=e.offsetX-a,k=e.offsetY-s;r.value=2,n.value={x:-I,y:-k},M()}else $()},D=e=>{ne(),e=Math.max(0,Math.min(z.value.length-1,e)),e!==o.value&&(c.value=!0,d.value=!1,o.value=e,$(),B(()=>{var a;const t=(a=R.value)==null?void 0:a.querySelector(".thumbnail-item.active");t&&t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}))},U=e=>{x.value+=e,B(()=>M())},se=()=>{T.value=!1,m("update:modelValue",!1),m("close")},oe=(e,t,a,s)=>Math.sqrt(Math.pow(a-e,2)+Math.pow(s-t,2)),re=(e,t,a,s)=>({x:(e+a)/2,y:(t+s)/2}),ce=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);Fe(()=>{window.addEventListener("keydown",ve),window.addEventListener("resize",ue),document.addEventListener("click",ie),H(),T.value&&(c.value=!0,Q(),de())}),Ve(()=>{window.removeEventListener("keydown",ve),window.removeEventListener("resize",ue),document.removeEventListener("click",ie),clearTimeout(P.value)});const ue=()=>{Q(),g.value&&(h.value={width:g.value.offsetWidth,height:g.value.offsetHeight},r.value===1?$():M())},ve=e=>{switch(e.key){case"ArrowLeft":D(o.value-1);break;case"ArrowRight":D(o.value+1);break;case"Escape":se();break;case"+":r.value=Math.min(5,r.value+.1),M();break;case"-":r.value=Math.max(V.value,r.value-.1),M();break;case"r":U(90);break;case"R":U(-90);break;case"0":$();break}};ee(()=>p.modelValue,e=>{T.value=e,e&&(H(),c.value=!0,de(),Q(),$(),B(()=>{var a;const t=(a=R.value)==null?void 0:a.querySelector(".thumbnail-item.active");t&&t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}))});const de=()=>{if(p.initialUrl){const e=z.value.findIndex(t=>t.originalSrc&&t.originalSrc===p.initialUrl||t.src&&t.src===p.initialUrl);o.value=e>=0?e:p.initialIndex}else o.value=p.initialIndex},Ye=()=>{o.value>0&&D(o.value-1)},Le=()=>{o.value<z.value.length-1&&D(o.value+1)};return(e,t)=>T.value?(y(),_("div",{key:0,class:"image-preview-container",ref_key:"containerRef",ref:S},[b("div",{onClick:N(se,["stop"]),class:"top-close-btn"},"关闭"),b("div",{class:"main-image-wrapper",ref_key:"mainImageWrapper",ref:C,style:me(xe.value)},[b("img",{ref_key:"mainImageRef",ref:g,src:ae.value.originalSrc||ae.value.src,style:me(Ie.value),onDblclick:$e,onTouchstart:Me,onTouchmove:Pe,onTouchend:Xe,onWheel:N(Ce,["prevent"]),onLoad:ke,onError:Te,onMousedown:Se},null,44,at),c.value?(y(),_("div",nt,"加载中...")):F("",!0),d.value?(y(),_("div",it,"图片加载失败")):F("",!0)],4),f.value?(y(),_("div",{key:0,onClick:N(ne,["stop"]),class:"image-preview-bottom-container"},[b("div",lt,[b("button",{onClick:Ye},"<"),b("button",{onClick:t[0]||(t[0]=a=>U(-90))},"左旋转"),b("button",{onClick:t[1]||(t[1]=a=>U(90))},"右旋转"),b("button",{onClick:$},"重置"),b("button",{onClick:Le}," > ")]),b("div",st,[b("div",{class:"thumbnail-container",ref_key:"thumbnailContainer",ref:R},[(y(!0),_(j,null,te(z.value,(a,s)=>(y(),_("div",{key:s,class:we(["thumbnail-item",{active:o.value===s}]),onClick:N(I=>D(s),["stop"])},[b("img",{src:a.thumbnailSrc||a.src,"data-index":s,loading:"lazy"},null,8,rt)],10,ot))),128))],512)])])):F("",!0)],512)):F("",!0)}},mt=q(dt,[["__scopeId","data-v-55cf6f55"]]),ht={"aria-label":"breadcrumb",class:"breadcrumb-nav"},ft={class:"breadcrumb-list"},pt={key:1,class:"breadcrumb-text"},gt={key:2,class:"breadcrumb-separator"},yt={__name:"Breadcrumb",props:{separator:{type:String,default:">"},staticItems:{type:Array,default:()=>[]}},setup(v){const w=v,p=be(),m=E(()=>p.matched.filter(o=>o.meta&&o.meta.breadcrumb).map(o=>({text:o.meta.breadcrumb,to:o.path}))),T=E(()=>[...w.staticItems,...m.value]);return(o,r)=>{const x=Re("router-link");return y(),_("nav",ht,[b("ol",ft,[(y(!0),_(j,null,te(T.value,(n,c)=>(y(),_("li",{key:c,class:"breadcrumb-item"},[n.to?(y(),_e(x,{key:0,to:n.to,class:"breadcrumb-link"},{default:ze(()=>[We(O(n.text),1)]),_:2},1032,["to"])):(y(),_("span",pt,O(n.text),1)),c<T.value.length-1?(y(),_("span",gt,O(v.separator),1)):F("",!0)]))),128))])])}}},wt=q(yt,[["__scopeId","data-v-0e6e779a"]]);function bt(v){return Be({url:"/files/list",method:"get",params:{path:v}})}const _t={__name:"FileList",setup(v){const w=be(),p=Oe();let m=u([]),T=u(!1),o=u(!1),r=u([{text:"ROOT",to:"/files"}]),x=u([]),n=u(""),c=u(!1);He(()=>{S(),d()});function d(){r.value=[{text:"ROOT",to:"/files"}];for(let i=0;i<w.params.paths.length;i++){let h=w.params.paths[i],f=w.params.paths.slice(0,i+1),P={text:h};i!==w.params.paths.length-1&&(P.to="/files"+fe(f)),r.value.push(P)}}function S(){o.value=!0,m.value=[],bt(fe(w.params.paths)).then(i=>{m.value=i,o.value=!1,B(()=>{if(w.hash){const h=w.hash.substring(1);g(h)}})})}function g(i){const h=document.getElementById(i);h&&(h.scrollIntoView({behavior:"auto",block:"start"}),h.classList.add("highlighted-file"),setTimeout(()=>{h.classList.remove("highlighted-file")},1e3))}ee(()=>w.params.paths,(i,h)=>{i.length===h.length&&i.every((P,l)=>P===h[l])&&(c.value=!1);let f=w.params.paths[w.params.paths.length-1];f?document.title=f:document.title="File Viewer",S(),d()}),ee(()=>w.hash,(i,h)=>{if(i){const f=i.substring(1);g(f)}});function C(i){let h=qe(i.filePath);if(window.location.hash=i.fileName,i.fileType==="folder")p.push({name:"FileList",params:{paths:h}});else if(L.isVideo(i.fileType))p.push({name:"Player",params:{paths:h}});else if(L.isImage(i.fileType)){x.value=[];for(let f of m.value)L.isImage(f.fileType)&&x.value.push({thumbnailSrc:"/api/images/getThumbnail?path="+f.filePath,originalSrc:"/api/files/getFile?path="+f.filePath});n.value="/api/files/getFile?path="+i.filePath,c.value=!0}else p.push({name:"FileList",params:{paths:h}})}function R(i){if(!T.value){let h=i[0];C(h)}}function X(i){return L.isImage(i.fileType)?"/api/images/getThumbnail?path="+i.filePath:L.isVideo(i.fileType)?"/api/videos/getPreview?path="+i.filePath:""}return(i,h)=>{const f=Ue("loading");return y(),_(j,null,[he(wt,{"static-items":Y(r),separator:"/"},null,8,["static-items"]),Ae(he(tt,{class:"file-viewer","file-name":"fileName","file-type":"fileType","mime-type":"mimeType","id-prop":"fileName",empty:"empty",multiple:Y(T),files:Y(m),"get-icon":X,onChoose:R},null,8,["multiple","files"]),[[f,Y(o)]]),Y(x).length!==0?(y(),_e(mt,{key:0,modelValue:Y(c),"onUpdate:modelValue":h[0]||(h[0]=P=>Ne(c)?c.value=P:c=P),images:Y(x),"initial-url":Y(n)},null,8,["modelValue","images","initial-url"])):F("",!0)],64)}}},kt=q(_t,[["__scopeId","data-v-88c9c5e8"]]);export{kt as default};
