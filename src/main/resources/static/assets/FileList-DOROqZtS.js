import{_ as Q,r as c,c as M,o as T,F as Z,e as ge,n as ye,f as w,g as $,t as De,h as W,i as Ee,j as Fe,k as J,l as O,m as ve,p as B,q as $e,s as Ve,u as Re,a as he,v as ze,x as We,y as L,z as Be,A as He,B as Ae}from"./index-BKCWTq7P.js";import{a as me,B as Ue,p as Oe}from"./path_utils-BOv8yoCY.js";const de=["mp4","wmv","flv","rm","mp4","3gp","avi","mpg","rmvb","mov","m4v","m3u8","mkv","asf","mts"],fe=["jpg","png","jpeg","tiff","gif","eps","svg","bmp","webp"],pe=["zip","7z","rar","tar"],D={VIDEO_SUFFIX:de,IMAGE_SUFFIX:fe,PACKAGE_SUFFIX:pe,isVideo(h){return h==null||h===""?!1:de.indexOf(h.toLowerCase())!==-1},isImage(h){return h==null||h===""?!1:fe.indexOf(h.toLowerCase())!==-1},isPackage(h){return h==null||h===""?!1:pe.indexOf(h.toLowerCase())!==-1}},Ne={class:"file-viewer"},qe=["id","onClick"],je={class:"icon-container"},Ge=["src"],Ke=["src"],Je={class:"file-name"},Qe={__name:"FileViewer",props:{multiple:{type:Boolean,default:!1},files:{type:Array,required:!0},fileType:{type:String,required:!0},fileName:{type:String,required:!0},mimeType:{type:String,required:!0},empty:String,getIcon:Function,idProp:String},emits:["choose"],setup(h,{emit:y}){const g=y,d=h;function P(n){if(!d.multiple){g("choose",[n]);return}n.selected=!n.selected;let r=[];for(let v of d.files)v.selected&&r.push(v);g("choose",r)}const u=c({});function o(n){var r;return n[d.fileType]==="folder"?d.empty&&n[d.empty]?"/icons/folder_empty.png":"/icons/folder.png":(r=n[d.mimeType])!=null&&r.startsWith("video")||D.isVideo(n[d.fileType])?"/icons/video.png":D.isImage(n[d.fileType])?"/icons/image.png":D.isPackage(n[d.fileType])?"/icons/package.png":"/icons/unknown.png"}function I(n){const r=n.id||n[d.fileName];if(u.value[r]===void 0&&(u.value[r]={defaultIcon:o(n),customIcon:null,loading:!1,loaded:!1},typeof d.getIcon=="function")){const v=d.getIcon(n);if(typeof v=="string"&&v.trim()!==""){u.value[r].loading=!0;const _=new Image;_.onload=()=>{u.value[r]={...u.value[r],customIcon:v,loading:!1,loaded:!0}},_.onerror=()=>{u.value[r].loading=!1},_.src=v}}return u.value[r]}return(n,r)=>(T(),M("ul",Ne,[(T(!0),M(Z,null,ge(h.files,v=>(T(),M("li",{id:v[d.idProp],onClick:_=>P(v),class:ye(["viewer-item",{selected:v.selected}])},[w("div",je,[w("img",{class:"main-icon",src:I(v).customIcon||I(v).defaultIcon},null,8,Ge),I(v).customIcon?(T(),M("img",{key:0,class:"small-default-icon",src:I(v).defaultIcon},null,8,Ke)):$("",!0)]),w("p",Je,De(v[h.fileName]),1)],10,qe))),256))]))}},Ze=Q(Qe,[["__scopeId","data-v-bbc9a87d"]]),et=["src"],tt={key:0,class:"loading-indicator"},at={key:1,class:"error-indicator"},nt={class:"control-buttons"},it={class:"thumbnail-scroll-container"},lt=["onClick"],st=["src","data-index"],ot=3e3,rt=50,ct=.5,ut={__name:"ImagePreview",props:{images:{type:Array,required:!0,default:()=>[]},initialIndex:{type:Number,default:0},initialUrl:{type:String,default:""},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","close"],setup(h,{emit:y}){const g=h,d=y,P=c(g.modelValue),u=c(g.initialIndex),o=c(1),I=c(0),n=c({x:0,y:0}),r=c(!1),v=c(!1),_=c(null),p=c(null),C=c(null),V=c(null),X=c({width:0,height:0}),i=c({width:0,height:0}),m=c({width:0,height:0}),f=c(!0),S=c(null),l=c({mode:null,startX:0,startY:0,startDistance:0,startScale:1,startPosition:{x:0,y:0},lastTouchTime:0,isSwiping:!1,centerPoint:{x:0,y:0}}),N=c(0),q=c(0),j=c(0),we=W(()=>({width:`${X.value.width}px`,height:`${X.value.height-160}px`})),F=W(()=>{if(!p.value||!C.value)return 1;const e=C.value.clientWidth,t=C.value.clientHeight-160,a=i.value.width,s=i.value.height,x=e/a,b=t/s;return Math.max(Math.min(x,b),.5)}),R=W(()=>g.images.map(e=>typeof e=="string"?{src:e,thumbnailSrc:e}:{...e,thumbnailSrc:e.thumbnailSrc||e.src})),ee=W(()=>R.value[u.value]||{}),xe=W(()=>({transform:`scale(${o.value}) rotate(${I.value}deg) translate(${n.value.x}px, ${n.value.y}px)`,transition:l.value.mode==="drag"?"none":"transform 0.2s ease-out"})),H=()=>{clearTimeout(S.value),S.value=setTimeout(()=>{f.value=!1},ot)},te=()=>{f.value=!0,H()},ae=()=>{f.value=!f.value,f.value&&H()},G=()=>{_.value&&(X.value={width:_.value.clientWidth,height:_.value.clientHeight})},k=()=>{if(!p.value||!C.value)return;const e=C.value,t=o.value,a=i.value.width*t,s=i.value.height*t,x=Math.max(0,(a-e.clientWidth)/2),b=Math.max(0,(s-e.clientHeight)/2);n.value={x:Math.max(-x,Math.min(x,n.value.x)),y:Math.max(-b,Math.min(b,n.value.y))},o.value=Math.max(F.value,Math.min(5,o.value))},Y=()=>{if(o.value=Math.max(F.value,1),I.value=0,n.value={x:0,y:0},oe()&&p.value){const e=p.value,t=e.naturalHeight/e.naturalWidth,a=X.value.width,s=X.value.height-160;a*t>s?(e.style.height=`${s}px`,e.style.width=`${s/t}px`):(e.style.width=`${a}px`,e.style.height=`${a*t}px`)}B(()=>k())},be=()=>{if(r.value=!1,v.value=!1,p.value&&(i.value={width:p.value.naturalWidth,height:p.value.naturalHeight},o.value=Math.max(F.value,1),oe())){const e=p.value,t=e.naturalHeight/e.naturalWidth,a=X.value.width,s=X.value.height-160;a*t>s?(e.style.height=`${s}px`,e.style.width=`${s/t}px`):(e.style.width=`${a}px`,e.style.height=`${a*t}px`)}Y()},Ie=()=>{r.value=!1,v.value=!0},_e=e=>{e.button===0&&(e.preventDefault(),l.value={mode:"drag",startX:e.clientX,startY:e.clientY,startPosition:{...n.value},startScale:o.value,isSwiping:!0},document.addEventListener("mousemove",ne),document.addEventListener("mouseup",A),document.addEventListener("mouseleave",A))},ne=e=>{if(l.value.mode!=="drag")return;const t=e.clientX-l.value.startX,a=e.clientY-l.value.startY;n.value={x:l.value.startPosition.x+t,y:l.value.startPosition.y+a},k()},A=()=>{l.value.mode==="drag"&&(l.value.mode=null,document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",A),document.removeEventListener("mouseleave",A),k())},ke=e=>{if(e.touches.length===1)l.value={mode:"switch",startX:e.touches[0].clientX,startY:e.touches[0].clientY,startPosition:{...n.value},startScale:o.value,lastTouchTime:Date.now(),isSwiping:!1},N.value=0,q.value=Date.now(),j.value=e.touches[0].clientX;else if(e.touches.length===2){const t=e.touches[0],a=e.touches[1];l.value={mode:"zoom",startDistance:le(t.clientX,t.clientY,a.clientX,a.clientY),startScale:o.value,startPosition:{...n.value},centerPoint:se(t.clientX,t.clientY,a.clientX,a.clientY)}}},Te=e=>{if(l.value.mode==="switch"&&e.touches.length===1){const t=e.touches[0],a=t.clientX-l.value.startX,s=t.clientY-l.value.startY,x=Date.now(),b=x-q.value,z=t.clientX-j.value;b>0&&(N.value=z/b),q.value=x,j.value=t.clientX,!l.value.isSwiping&&(Math.abs(a)>5||Math.abs(s)>5)&&(l.value.isSwiping=!0),l.value.isSwiping&&(o.value===1?n.value={x:l.value.startPosition.x+a,y:l.value.startPosition.y+s}:(n.value={x:l.value.startPosition.x+a,y:l.value.startPosition.y+s},k())),e.preventDefault()}else if(l.value.mode==="zoom"&&e.touches.length===2){const t=e.touches[0],a=e.touches[1],s=le(t.clientX,t.clientY,a.clientX,a.clientY),x=Math.max(F.value,Math.min(5,l.value.startScale*(s/l.value.startDistance))),b=se(t.clientX,t.clientY,a.clientX,a.clientY),z=b.x-l.value.centerPoint.x,K=b.y-l.value.centerPoint.y;n.value={x:l.value.startPosition.x+z,y:l.value.startPosition.y+K},o.value=x,k(),e.preventDefault()}},Se=e=>{if(l.value.mode==="switch"&&l.value.isSwiping){if(o.value===1){const t=e.changedTouches[0].clientX-l.value.startX;Date.now()-l.value.lastTouchTime;const a=Math.min(ct,Math.max(-.5,N.value)),s=t+a*100;(Math.abs(s)>rt||Math.abs(a)>.2)&&(s>0?E(u.value-1):E(u.value+1))}o.value===1&&Y()}else l.value.mode==="zoom"&&k();l.value.mode=null},Me=e=>{if(!p.value)return;e.preventDefault();const t=e.deltaY>0?-.1:.1,a=Math.max(F.value,Math.min(5,o.value+t)),s=p.value.getBoundingClientRect(),x=e.clientX-s.left,b=e.clientY-s.top,z=s.width/2,K=s.height/2,Ye=x-z,Le=b-K;n.value={x:n.value.x-Ye*(a-o.value)/o.value,y:n.value.y-Le*(a-o.value)/o.value},o.value=a,k()},Pe=e=>{if(o.value===1){const t=p.value.getBoundingClientRect(),a=t.width/2,s=t.height/2,x=e.offsetX-a,b=e.offsetY-s;o.value=2,n.value={x:-x,y:-b},k()}else Y()},E=e=>{te(),e=Math.max(0,Math.min(R.value.length-1,e)),e!==u.value&&(r.value=!0,v.value=!1,u.value=e,Y(),B(()=>{var a;const t=(a=V.value)==null?void 0:a.querySelector(".thumbnail-item.active");t&&t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}))},U=e=>{I.value+=e,B(()=>k())},ie=()=>{P.value=!1,d("update:modelValue",!1),d("close")},le=(e,t,a,s)=>Math.sqrt(Math.pow(a-e,2)+Math.pow(s-t,2)),se=(e,t,a,s)=>({x:(e+a)/2,y:(t+s)/2}),oe=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);Ee(()=>{window.addEventListener("keydown",ce),window.addEventListener("resize",re),document.addEventListener("click",ae),H(),P.value&&(r.value=!0,G(),ue())}),Fe(()=>{window.removeEventListener("keydown",ce),window.removeEventListener("resize",re),document.removeEventListener("click",ae),clearTimeout(S.value)});const re=()=>{G(),p.value&&(m.value={width:p.value.offsetWidth,height:p.value.offsetHeight},o.value===1?Y():k())},ce=e=>{switch(e.key){case"ArrowLeft":E(u.value-1);break;case"ArrowRight":E(u.value+1);break;case"Escape":ie();break;case"+":o.value=Math.min(5,o.value+.1),k();break;case"-":o.value=Math.max(F.value,o.value-.1),k();break;case"r":U(90);break;case"R":U(-90);break;case"0":Y();break}};J(()=>g.modelValue,e=>{P.value=e,e&&(H(),r.value=!0,ue(),G(),Y(),B(()=>{var a;const t=(a=V.value)==null?void 0:a.querySelector(".thumbnail-item.active");t&&t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}))});const ue=()=>{if(g.initialUrl){const e=R.value.findIndex(t=>t.originalSrc&&t.originalSrc===g.initialUrl||t.src&&t.src===g.initialUrl);u.value=e>=0?e:g.initialIndex}else u.value=g.initialIndex},Xe=()=>{u.value>0&&E(u.value-1)},Ce=()=>{u.value<R.value.length-1&&E(u.value+1)};return(e,t)=>P.value?(T(),M("div",{key:0,class:"image-preview-container",ref_key:"containerRef",ref:_},[w("div",{onClick:O(ie,["stop"]),class:"top-close-btn"},"关闭"),w("div",{class:"main-image-wrapper",ref_key:"mainImageWrapper",ref:C,style:ve(we.value)},[w("img",{ref_key:"mainImageRef",ref:p,src:ee.value.originalSrc||ee.value.src,style:ve(xe.value),onDblclick:Pe,onTouchstart:ke,onTouchmove:Te,onTouchend:Se,onWheel:O(Me,["prevent"]),onLoad:be,onError:Ie,onMousedown:_e},null,44,et),r.value?(T(),M("div",tt,"加载中...")):$("",!0),v.value?(T(),M("div",at,"图片加载失败")):$("",!0)],4),f.value?(T(),M("div",{key:0,onClick:O(te,["stop"]),class:"image-preview-bottom-container"},[w("div",nt,[w("button",{onClick:Xe},"<"),w("button",{onClick:t[0]||(t[0]=a=>U(-90))},"左旋转"),w("button",{onClick:t[1]||(t[1]=a=>U(90))},"右旋转"),w("button",{onClick:Y},"重置"),w("button",{onClick:Ce}," > ")]),w("div",it,[w("div",{class:"thumbnail-container",ref_key:"thumbnailContainer",ref:V},[(T(!0),M(Z,null,ge(R.value,(a,s)=>(T(),M("div",{key:s,class:ye(["thumbnail-item",{active:u.value===s}]),onClick:O(x=>E(s),["stop"])},[w("img",{src:a.thumbnailSrc||a.src,"data-index":s,loading:"lazy"},null,8,st)],10,lt))),128))],512)])])):$("",!0)],512)):$("",!0)}},vt=Q(ut,[["__scopeId","data-v-55cf6f55"]]);function ht(h){return $e({url:"/files/list",method:"get",params:{path:h}})}const mt={__name:"FileList",setup(h){const y=Re(),g=Ae();let d=c([]),P=c(!1),u=c(!1),o=c([{text:"ROOT",to:"/files"}]),I=c([]),n=c(""),r=c(!1);Ve(()=>{_(),v()});function v(){o.value=[{text:"ROOT",to:"/files"}];for(let i=0;i<y.params.paths.length;i++){let m=y.params.paths[i],f=y.params.paths.slice(0,i+1),S={text:m};i!==y.params.paths.length-1&&(S.to="/files"+me(f)),o.value.push(S)}}function _(){u.value=!0,d.value=[],ht(me(y.params.paths)).then(i=>{d.value=i,u.value=!1,B(()=>{if(y.hash){const m=y.hash.substring(1);p(m)}})})}function p(i){const m=document.getElementById(i);m&&(m.scrollIntoView({behavior:"auto",block:"start"}),m.classList.add("highlighted-file"),setTimeout(()=>{m.classList.remove("highlighted-file")},1e3))}J(()=>y.params.paths,(i,m)=>{i.length===m.length&&i.every((S,l)=>S===m[l])&&(r.value=!1);let f=y.params.paths[y.params.paths.length-1];f?document.title=f:document.title="File Viewer",_(),v()}),J(()=>y.hash,(i,m)=>{if(i){const f=i.substring(1);p(f)}});function C(i){let m=Oe(i.filePath);if(window.location.hash=i.fileName,i.fileType==="folder")g.push({name:"FileList",params:{paths:m}});else if(D.isVideo(i.fileType))g.push({name:"Player",params:{paths:m}});else if(D.isImage(i.fileType)){I.value=[];for(let f of d.value)D.isImage(f.fileType)&&I.value.push({thumbnailSrc:"http://192.168.10.33:8080/api/images/getThumbnail?path="+f.filePath,originalSrc:"http://192.168.10.33:8080/api/files/getFile?path="+f.filePath});n.value="http://192.168.10.33:8080/api/files/getFile?path="+i.filePath,r.value=!0}else g.push({name:"FileList",params:{paths:m}})}function V(i){if(!P.value){let m=i[0];C(m)}}function X(i){return D.isImage(i.fileType)?"http://192.168.10.33:8080/api/images/getThumbnail?path="+i.filePath:D.isVideo(i.fileType)?"http://192.168.10.33:8080/api/videos/getPreview?path="+i.filePath:""}return(i,m)=>{const f=Be("loading");return T(),M(Z,null,[he(Ue,{"static-items":L(o),separator:"/"},null,8,["static-items"]),ze(he(Ze,{class:"file-viewer","file-name":"fileName","file-type":"fileType","mime-type":"mimeType","id-prop":"fileName",empty:"empty",multiple:L(P),files:L(d),"get-icon":X,onChoose:V},null,8,["multiple","files"]),[[f,L(u)]]),L(I).length!==0?(T(),We(vt,{key:0,modelValue:L(r),"onUpdate:modelValue":m[0]||(m[0]=S=>He(r)?r.value=S:r=S),images:L(I),"initial-url":L(n)},null,8,["modelValue","images","initial-url"])):$("",!0)],64)}}},pt=Q(mt,[["__scopeId","data-v-88c9c5e8"]]);export{pt as default};
